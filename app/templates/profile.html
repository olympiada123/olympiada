{% extends 'base.html' %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –û–ª–∏–º–ø–∏–∞–¥–∞{% endblock %}

{% block content %}
<div class="container">
    <div class="about-page">
        <h1 class="about-page-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>

        <section class="about-section">
            <div class="profile-layout">
                <div class="detail-section-card profile-info-card">
                    <h2 class="section-title">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                    <div class="profile-info-compact">
                        <div class="profile-info-card-item">
                            <div class="profile-info-content">
                                <span class="profile-info-label">–ò–º—è</span>
                                <span class="profile-info-value">{{ user.first_name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</span>
                            </div>
                        </div>
                        <div class="profile-info-card-item">
                            <div class="profile-info-content">
                                <span class="profile-info-label">–§–∞–º–∏–ª–∏—è</span>
                                <span class="profile-info-value">{{ user.last_name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</span>
                            </div>
                        </div>
                        <div class="profile-info-card-item">
                            <div class="profile-info-content">
                                <span class="profile-info-label">–†–æ–ª—å</span>
                                <span class="profile-info-value profile-role profile-role-{% if role == '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' %}admin{% elif role == '–ö—É—Ä–∞—Ç–æ—Ä' %}curator{% else %}student{% endif %}">{{ role }}</span>
                            </div>
                        </div>
                        <div class="profile-info-card-item">
                            <div class="profile-info-content">
                                <span class="profile-info-label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</span>
                                <span class="profile-info-value">{{ user.created_at|date:"d.m.Y" }}</span>
                            </div>
                        </div>
                        <div class="profile-info-actions">
                            <a href="{% url 'settings' %}" class="btn btn-secondary btn-sm">
                                <span class="btn-icon">‚úèÔ∏è</span>
                                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                            </a>
                        </div>
                    </div>
                </div>

                {% if not user.is_superuser %}
                <div class="detail-section-card profile-olympiads-card">
                <h2 class="section-title">–ú–æ–∏ –æ–ª–∏–º–ø–∏–∞–¥—ã</h2>
                {% if registrations %}
                <div class="registrations-list">
                    {% for registration in registrations %}
                    <div class="registration-card">
                        <div class="registration-header">
                            <h3 class="registration-title">
                                <a href="{% url 'olympiad_detail' registration.olympiad.id %}" class="registration-link">
                                    {{ registration.olympiad.name }}
                                </a>
                            </h3>
                            <span class="registration-status registration-status-{{ registration.status }}">
                                {{ registration.get_status_display }}
                            </span>
                        </div>
                        <div class="registration-details">
                            <div class="registration-detail-item">
                                <span class="detail-icon">üìÖ</span>
                                <span class="detail-text">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {{ registration.registered_at|date:"d.m.Y" }}</span>
                            </div>
                            {% if registration.subjects.all %}
                            <div class="registration-detail-item">
                                <span class="detail-icon">üìö</span>
                                <span class="detail-text">–ü—Ä–µ–¥–º–µ—Ç—ã: {% for subject in registration.subjects.all %}{{ subject.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p class="empty-state-text">–í—ã –µ—â–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∏ –Ω–∞ –æ–¥–Ω—É –æ–ª–∏–º–ø–∏–∞–¥—É.</p>
                    <a href="{% url 'olympiads' %}" class="btn btn-primary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–ª–∏–º–ø–∏–∞–¥—ã</a>
                </div>
                {% endif %}
                </div>
                {% endif %}

                {% if user.is_superuser and all_users %}
                <div class="detail-section-card profile-olympiads-card">
                    <h2 class="section-title">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</h2>
                    <div class="users-role-management">
                        <div class="users-list">
                            {% for target_user in all_users %}
                            <div class="user-role-item">
                                <div class="user-role-info">
                                    <div class="user-role-name">
                                        <strong>{{ target_user.get_full_name|default:target_user.username }}</strong>
                                        <span class="user-role-username">({{ target_user.username }})</span>
                                    </div>
                                    <div class="user-role-current">
                                        <span class="profile-role profile-role-{% if target_user.is_superuser %}admin{% elif target_user.is_staff %}curator{% else %}student{% endif %}">
                                            {% if target_user.is_superuser %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä{% elif target_user.is_staff %}–ö—É—Ä–∞—Ç–æ—Ä{% else %}–°—Ç—É–¥–µ–Ω—Ç{% endif %}
                                        </span>
                                    </div>
                                </div>
                                <form method="post" class="user-role-form">
                                    {% csrf_token %}
                                    <input type="hidden" name="user_id" value="{{ target_user.id }}">
                                    <select name="role" class="role-select" onchange="this.form.submit()">
                                        <option value="student" {% if not target_user.is_superuser and not target_user.is_staff %}selected{% endif %}>–°—Ç—É–¥–µ–Ω—Ç</option>
                                        <option value="curator" {% if target_user.is_staff and not target_user.is_superuser %}selected{% endif %}>–ö—É—Ä–∞—Ç–æ—Ä</option>
                                        <option value="admin" {% if target_user.is_superuser %}selected{% endif %}>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                                    </select>
                                </form>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </section>
    </div>
</div>
{% endblock %}

