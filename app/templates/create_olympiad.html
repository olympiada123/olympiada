{% extends 'base.html' %}

{% block title %}Создать олимпиаду - Олимпиада{% endblock %}

{% block content %}
<div class="container">
    <div class="about-page">
        <h1 class="about-page-title">Создать олимпиаду</h1>

        <section class="about-section">
            <div class="detail-section-card">
                <a href="{% url 'profile' %}" class="back-link">← Назад к профилю</a>
                
                <form method="post" class="olympiad-form">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="id_name" class="form-label">Название олимпиады *</label>
                        <input 
                            type="text" 
                            name="name" 
                            id="id_name" 
                            class="form-control" 
                            required 
                            placeholder="Введите название олимпиады"
                        >
                    </div>

                    <div class="form-group">
                        <label for="id_description" class="form-label">Описание</label>
                        <textarea 
                            name="description" 
                            id="id_description" 
                            class="form-control" 
                            rows="5"
                            placeholder="Введите описание олимпиады"
                        ></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_start_date" class="form-label">Дата начала олимпиады *</label>
                            <input 
                                type="datetime-local" 
                                name="start_date" 
                                id="id_start_date" 
                                class="form-control" 
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="id_end_date" class="form-label">Дата окончания олимпиады *</label>
                            <input 
                                type="datetime-local" 
                                name="end_date" 
                                id="id_end_date" 
                                class="form-control" 
                                required
                            >
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_registration_start" class="form-label">Начало регистрации *</label>
                            <input 
                                type="datetime-local" 
                                name="registration_start" 
                                id="id_registration_start" 
                                class="form-control" 
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="id_registration_end" class="form-label">Окончание регистрации *</label>
                            <input 
                                type="datetime-local" 
                                name="registration_end" 
                                id="id_registration_end" 
                                class="form-control" 
                                required
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="id_max_subjects_per_student" class="form-label">Максимум предметов на студента *</label>
                        <input 
                            type="number" 
                            name="max_subjects_per_student" 
                            id="id_max_subjects_per_student" 
                            class="form-control" 
                            value="1"
                            min="1"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">Предметы олимпиады *</label>
                        <div class="subjects-search-wrapper">
                            <input 
                                type="text" 
                                id="subject-search" 
                                class="subjects-search-input" 
                                placeholder="Поиск предметов..."
                            >
                        </div>
                        <div class="subjects-checkbox-group" id="subjects-list">
                            {% for subject in subjects %}
                            <div class="form-checkbox-item" data-subject-name="{{ subject.name|lower }}">
                                <input 
                                    type="checkbox" 
                                    name="subjects" 
                                    id="subject_{{ subject.id }}" 
                                    value="{{ subject.id }}"
                                    class="form-checkbox"
                                >
                                <label for="subject_{{ subject.id }}" class="form-checkbox-label">{{ subject.name }}</label>
                            </div>
                            {% endfor %}
                        </div>
                        {% if not subjects %}
                        <p class="form-help-text" style="color: var(--text-secondary);">Нет доступных предметов. Создайте предметы в админ-панели.</p>
                        {% endif %}
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Создать олимпиаду</button>
                        <a href="{% url 'profile' %}" class="btn btn-secondary">Отмена</a>
                    </div>
                </form>
            </div>
        </section>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% load static %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('subject-search');
    const subjectsList = document.getElementById('subjects-list');
    
    if (searchInput && subjectsList) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            const items = subjectsList.querySelectorAll('.form-checkbox-item');
            
            items.forEach(function(item) {
                const subjectName = item.getAttribute('data-subject-name');
                if (subjectName && subjectName.includes(searchTerm)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        });
    }
});
</script>
{% endblock %}

