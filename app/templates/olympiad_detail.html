{% extends 'base.html' %}

{% block title %}{{ olympiad.name }} - –û–ª–∏–º–ø–∏–∞–¥–∞{% endblock %}

{% block content %}
<div class="container">
    <div class="about-page">
        <div class="olympiad-detail-header">
            <a href="{% url 'olympiads' %}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –æ–ª–∏–º–ø–∏–∞–¥–∞–º</a>
            <div class="olympiad-header-content">
                <div class="olympiad-header-info">
                    <h1 class="about-page-title">{{ olympiad.name }}</h1>
                    <span class="olympiad-status olympiad-status-{{ status }}">{{ status_display }}</span>
                    {% if olympiad.description %}
                    <p class="olympiad-description-text">{{ olympiad.description }}</p>
                    {% endif %}
                </div>
                <div class="olympiad-header-actions">
                    {% if user.is_authenticated %}
                        {% if is_registered %}
                            <span class="btn btn-secondary btn-large" style="cursor: default;">–í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã</span>
                        {% elif can_register %}
                            <a href="{% url 'register_for_olympiad' olympiad.id %}" class="btn btn-primary btn-large">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                        {% elif status == 'upcoming' %}
                            <span class="btn btn-secondary btn-large" style="cursor: default;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–∫–æ—Ä–æ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è</span>
                        {% elif status == 'finished' %}
                            <span class="btn btn-secondary btn-large" style="cursor: default;">–û–ª–∏–º–ø–∏–∞–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                        {% else %}
                            <span class="btn btn-secondary btn-large" style="cursor: default;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞</span>
                        {% endif %}
                    {% else %}
                        {% if status == 'active' %}
                            <a href="{% url 'login' %}?next={% url 'olympiad_detail' olympiad.id %}" class="btn btn-primary btn-large">–í–æ–π—Ç–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</a>
                        {% elif status == 'upcoming' %}
                            <span class="btn btn-secondary btn-large" style="cursor: default;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–∫–æ—Ä–æ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è</span>
                        {% elif status == 'finished' %}
                            <span class="btn btn-secondary btn-large" style="cursor: default;">–û–ª–∏–º–ø–∏–∞–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>

        <section class="about-section">
            <div class="olympiad-detail-grid">
                <div class="detail-section-card">
                    <h2 class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ª–∏–º–ø–∏–∞–¥–µ</h2>
                    <div class="olympiad-details-grid">
                        <div class="olympiad-detail-card">
                            <div class="detail-card-icon">üìÖ</div>
                            <div class="detail-card-content">
                                <h3 class="detail-card-title">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</h3>
                                <p class="detail-card-value">{{ olympiad.start_date|date:"d.m.Y" }} - {{ olympiad.end_date|date:"d.m.Y" }}</p>
                            </div>
                        </div>

                        <div class="olympiad-detail-card">
                            <div class="detail-card-icon">üìù</div>
                            <div class="detail-card-content">
                                <h3 class="detail-card-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                                <p class="detail-card-value">{{ olympiad.registration_start|date:"d.m.Y" }} - {{ olympiad.registration_end|date:"d.m.Y" }}</p>
                            </div>
                        </div>

                        <div class="olympiad-detail-card">
                            <div class="detail-card-icon">üìö</div>
                            <div class="detail-card-content">
                                <h3 class="detail-card-title">–ú–∞–∫—Å–∏–º—É–º –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h3>
                                <p class="detail-card-value">{{ olympiad.max_subjects_per_student }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                {% if status == 'upcoming' %}
                    {% if subjects %}
                    <div class="detail-section-card">
                        <h2 class="section-title">–ü—Ä–µ–¥–º–µ—Ç—ã –æ–ª–∏–º–ø–∏–∞–¥—ã</h2>
                        <div class="subjects-list">
                            {% for subject in subjects %}
                            <div class="subject-card">
                                <span class="subject-icon">üìñ</span>
                                <span class="subject-name">{{ subject.name }}</span>
                                {% if user.is_authenticated %}
                                    {% if user.is_staff or user.is_superuser %}
                                        <a href="{% url 'manage_questions' olympiad.id subject.id %}" class="btn btn-secondary btn-sm" style="margin-left: auto;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏</a>
                                    {% elif is_registered and subject.id in registered_subject_ids %}
                                        <a href="{% url 'start_exam' olympiad.id subject.id %}" class="btn btn-primary btn-sm" style="margin-left: auto;">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</a>
                                    {% endif %}
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                {% else %}
                    {% if top_students %}
                    <div class="detail-section-card">
                        <h2 class="section-title">–†–µ–π—Ç–∏–Ω–≥ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>
                        <div class="ranking-list ranking-list-columns">
                            {% for result in top_students %}
                            <div class="ranking-item ranking-item-compact">
                                <div class="ranking-position">
                                    {% if forloop.counter == 1 %}
                                        <span class="ranking-medal ranking-gold">ü•á</span>
                                    {% elif forloop.counter == 2 %}
                                        <span class="ranking-medal ranking-silver">ü•à</span>
                                    {% elif forloop.counter == 3 %}
                                        <span class="ranking-medal ranking-bronze">ü•â</span>
                                    {% else %}
                                        <span class="ranking-number">{{ forloop.counter }}</span>
                                    {% endif %}
                                </div>
                                <div class="ranking-student-info">
                                    <span class="ranking-student-name">{{ result.student.get_full_name|default:result.student.username }}</span>
                                </div>
                                <div class="ranking-score">
                                    <span class="ranking-score-value">{{ result.total_score }}</span>
                                    <span class="ranking-score-max">/ {{ result.max_possible_score }}</span>
                                    <span class="ranking-score-percentage">({{ result.percentage }}%)</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="detail-section-card">
                        <h2 class="section-title">–†–µ–π—Ç–∏–Ω–≥ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>
                        <p class="ranking-empty">–†–µ–π—Ç–∏–Ω–≥ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –æ–ª–∏–º–ø–∏–∞–¥—ã</p>
                    </div>
                    {% endif %}
                {% endif %}
            </div>

            {% if status != 'upcoming' and subjects %}
            <div class="detail-section-card">
                <h2 class="section-title">–ü—Ä–µ–¥–º–µ—Ç—ã –æ–ª–∏–º–ø–∏–∞–¥—ã</h2>
                <div class="subjects-list">
                    {% for subject in subjects %}
                    <div class="subject-card">
                        <span class="subject-icon">üìñ</span>
                        <span class="subject-name">{{ subject.name }}</span>
                        {% if user.is_authenticated %}
                            {% if user.is_staff or user.is_superuser %}
                                <a href="{% url 'manage_questions' olympiad.id subject.id %}" class="btn btn-secondary btn-sm" style="margin-left: auto;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏</a>
                            {% elif is_registered and subject.id in registered_subject_ids %}
                                <a href="{% url 'start_exam' olympiad.id subject.id %}" class="btn btn-primary btn-sm" style="margin-left: auto;">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</a>
                            {% endif %}
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </section>
    </div>
</div>
{% endblock %}

