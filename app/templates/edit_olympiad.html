{% extends 'base.html' %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ª–∏–º–ø–∏–∞–¥—É - –û–ª–∏–º–ø–∏–∞–¥–∞{% endblock %}

{% block content %}
<div class="container">
    <div class="about-page">
        <h1 class="about-page-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ª–∏–º–ø–∏–∞–¥—É</h1>

        <section class="about-section">
            <div class="detail-section-card">
                <a href="{% url 'profile' %}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Ñ–∏–ª—é</a>
                
                <form method="post" class="olympiad-form">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="id_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–ª–∏–º–ø–∏–∞–¥—ã *</label>
                        <input 
                            type="text" 
                            name="name" 
                            id="id_name" 
                            class="form-control" 
                            value="{{ olympiad.name }}"
                            required 
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–ª–∏–º–ø–∏–∞–¥—ã"
                        >
                    </div>

                    <div class="form-group">
                        <label for="id_description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea 
                            name="description" 
                            id="id_description" 
                            class="form-control" 
                            rows="5"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ª–∏–º–ø–∏–∞–¥—ã"
                        >{{ olympiad.description }}</textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_start_date" class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ–ª–∏–º–ø–∏–∞–¥—ã *</label>
                            <input 
                                type="datetime-local" 
                                name="start_date" 
                                id="id_start_date" 
                                class="form-control" 
                                value="{{ olympiad.start_date|date:'Y-m-d\TH:i' }}"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="id_end_date" class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–ª–∏–º–ø–∏–∞–¥—ã *</label>
                            <input 
                                type="datetime-local" 
                                name="end_date" 
                                id="id_end_date" 
                                class="form-control" 
                                value="{{ olympiad.end_date|date:'Y-m-d\TH:i' }}"
                                required
                            >
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="id_registration_start" class="form-label">–ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ *</label>
                            <input 
                                type="datetime-local" 
                                name="registration_start" 
                                id="id_registration_start" 
                                class="form-control" 
                                value="{{ olympiad.registration_start|date:'Y-m-d\TH:i' }}"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="id_registration_end" class="form-label">–û–∫–æ–Ω—á–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ *</label>
                            <input 
                                type="datetime-local" 
                                name="registration_end" 
                                id="id_registration_end" 
                                class="form-control" 
                                value="{{ olympiad.registration_end|date:'Y-m-d\TH:i' }}"
                                required
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="id_max_subjects_per_student" class="form-label">–ú–∞–∫—Å–∏–º—É–º –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –Ω–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ *</label>
                        <input 
                            type="number" 
                            name="max_subjects_per_student" 
                            id="id_max_subjects_per_student" 
                            class="form-control" 
                            value="{{ olympiad.max_subjects_per_student }}"
                            min="1"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç—ã –æ–ª–∏–º–ø–∏–∞–¥—ã *</label>
                        <div class="subjects-search-wrapper">
                            <input 
                                type="text" 
                                id="subject-search" 
                                class="subjects-search-input" 
                                placeholder="–ü–æ–∏—Å–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤..."
                            >
                        </div>
                        <div class="subjects-checkbox-group" id="subjects-list">
                            {% for subject in subjects %}
                            <div class="form-checkbox-item" data-subject-name="{{ subject.name|lower }}">
                                <input 
                                    type="checkbox" 
                                    name="subjects" 
                                    id="subject_{{ subject.id }}" 
                                    value="{{ subject.id }}"
                                    class="form-checkbox"
                                    {% if subject.id in current_subjects %}checked{% endif %}
                                >
                                <label for="subject_{{ subject.id }}" class="form-checkbox-label">{{ subject.name }}</label>
                            </div>
                            {% endfor %}
                        </div>
                        {% if not subjects %}
                        <p class="form-help-text" style="color: var(--text-secondary);">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.</p>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <div class="form-checkbox-item">
                            <input 
                                type="checkbox" 
                                name="is_active" 
                                id="id_is_active" 
                                class="form-checkbox"
                                {% if olympiad.is_active %}checked{% endif %}
                            >
                            <label for="id_is_active" class="form-checkbox-label">–û–ª–∏–º–ø–∏–∞–¥–∞ –∞–∫—Ç–∏–≤–Ω–∞</label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                        <a href="{% url 'profile' %}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                    </div>
                </form>
            </div>
        </section>

        {% if olympiad_subjects %}
        <section class="about-section">
            <div class="detail-section-card">
                <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞–º–∏ —Ç–µ—Å—Ç–∞</p>
                <div class="subjects-list">
                    {% for olympiad_subject in olympiad_subjects %}
                    <div class="subject-card">
                        <span class="subject-icon">üìñ</span>
                        <span class="subject-name">{{ olympiad_subject.subject.name }}</span>
                        <a href="{% url 'manage_questions' olympiad.id olympiad_subject.subject.id %}" class="btn btn-primary btn-sm" style="margin-left: auto;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% load static %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('subject-search');
    const subjectsList = document.getElementById('subjects-list');
    
    if (searchInput && subjectsList) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            const items = subjectsList.querySelectorAll('.form-checkbox-item');
            
            items.forEach(function(item) {
                const subjectName = item.getAttribute('data-subject-name');
                if (subjectName && subjectName.includes(searchTerm)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        });
    }
});
</script>
{% endblock %}

